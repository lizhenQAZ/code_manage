function judgeUserFirstLogin(e){var o=$.trim($("#username").val()),r=$.trim($("#username").attr("placeholder"));o.length>0&&o!=r?$.ajax({url:"/check/checkLoginName",data:{username:o},type:"POST",dataType:"json",success:function(o){if(o.success){var r=o.resultObject;$("#errorInfo").html(""),null!=r&&(isnull(r.firstLoginSign)?($(".check-verify").show(),first_login_sign=!0):(first_login_sign=!1,$(".check-verify").hide()),isnull(e)||e())}else $("#errorInfo").html('<i class="iconfont">&#xe63d;</i>'+o.errorMessage),hideVerify()}}):hideVerify()}function hideVerify(){$("#verify").val(""),$("#errorInfoyzm").text(""),$(".check-verify").hide()}function saveUserInfo(){if("checked"==$("#rmbUser").attr("checked")){var e=$("#username").val(),o=$("#password").val();$.cookie("rmbUser","true",{expires:7}),$.cookie("userName",e,{expires:7}),$.cookie("passWord",o,{expires:7})}else $.cookie("rmbUser","false",{expires:-1}),$.cookie("userName","",{expires:-1}),$.cookie("passWord","",{expires:-1})}function setCookie(e,o,r){var i=new Date,n=24*r*60*60*1e3;i.setTime(i.getTime()+n),document.cookie=e+"="+o+";path=/;domain=.boxuegu.com;expires="+i.toGMTString()}function checkCookie(){if(validNullPlaceholder($("#username"),$("#errorInfo"),"登录名")&&validNullPlaceholder($("#password"),$("#errorInfopwd"),"密码")){var e=document.cookie.split(";");if(""==e)return void beforeLogin();if(!(e.length>1))return void beforeLogin();for(var o=!0,r=0;r<e.length;r++){var i=e[r].split("=");"source"==i[0].trim()&&(layer.confirm("当前已登录了一个用户，请注销后重新登录!",{btn:["注销","取消"]},function(){layer.msg("注销成功,请重新登录",{time:1e3},function(e){setCookie("source","",-1),location.href="/logout",e.stopPropagation(),e.preventDefault()})}),o=!1)}if(o)return void beforeLogin()}}function isnull(e){return null==e||void 0==e||""==e}function beforeLogin(){judgeUserFirstLogin(function(){if(first_login_sign){var e=$.trim($("#username").val()),o=$.trim($("#verify").val()),r=$.trim($("#password").val()),i=$.trim($("#verify").attr("placeholder"));if(isnull(o)||o==i)return void $("#errorInfoyzm").html('<i class="iconfont">&#xe63d;</i>验证码不能为空');requestService("/check/checkLoginInfo",{mobile:e,password:r},function(r){r.success?requestService("/accountinfo/checkMobileCode",{mobile:e,code:o},function(e){e.success?login():$("#errorInfoyzm").html('<i class="iconfont">&#xe63d;</i>'+e.errorMessage)}):$("#errorInfo").html('<i class="iconfont">&#xe63d;</i>'+r.errorMessage)})}else $.ajax({url:"/check/checkLoginName",data:{username:$.trim($("#username").val()),password:$.trim($("#password").val())},type:"POST",dataType:"json",success:function(e){e.success?login():$("#errorInfo").html('<i class="iconfont">&#xe63d;</i>'+e.errorMessage)}})})}function login(){"checked"==$("#rmbUser").attr("checked")&&saveUserInfo(),layer.msg("登录中",{icon:16,shade:[.1,"#fff"],time:0,offset:["200px","40%"]}),$.ajax({url:contextPath+"/login.jsp",data:{username:$.trim($("#username").val()),password:$.trim($("#password").val())},type:"POST",dataType:"json",success:function(e){layer.closeAll(),e&&1==e.success?loginForward():""!=$("#password").val()?($("#errorInfopwd").text(""),$("#errorInfo").html('<i class="iconfont">&#xe63d;</i>账号或密码错误请重新输入')):($("#errorInfo").text(""),$("#errorInfopwd").html('<i class="iconfont">&#xe63d;</i>密码不能为空'))}})}function loginForward(){window.location.href="/index.html",setCookie("source","dual-student",1),$.get("/browser/loginLog",function(){}),$.get("/browser/logNowUV",{url:"login.jsp"},function(){})}var first_login_sign=!1;$(function(){function e(e){return null==e||void 0==e||""==e}var o,r=!1,i={},n=navigator.userAgent.toLowerCase();(o=n.match(/rv:([\d.]+)\) like gecko/))?i.ie=o[1]:(o=n.match(/msie ([\d.]+)/))?i.ie=o[1]:(o=n.match(/firefox\/([\d.]+)/))?i.firefox=o[1]:(o=n.match(/chrome\/([\d.]+)/))?i.chrome=o[1]:(o=n.match(/opera.([\d.]+)/))?i.opera=o[1]:(o=n.match(/version\/([\d.]+).*safari/))?i.safari=o[1]:0,i.firefox&&(r=!0),i.chrome&&(r=!0),i.safari&&(r=!0),r||$(".warning").removeClass("bowerSupport");var s=document.cookie.indexOf("rmbUser=");s!==-1&&"true"==$.cookie("rmbUser")&&($("#rmbUser").attr("checked",!0),$("#username").val($.cookie("userName")),$("#password").val($.cookie("passWord"))),supportPlaceholderNoRequireType(),$("#username").blur(function(){judgeUserFirstLogin()}),$("#password").focus(function(){judgeUserFirstLogin()}),$("#sendyzm").click(function(){var e=$(this);if(!e.hasClass("no-send")){var o=$.trim($("#username").val()),r={mobile:o,status:!1};$("#errorInfo").html("");var i=setClocking(e,90);requestService("/accountinfo/sendMobileCode ",r,function(o){o.success||(clearClockingTime(e,i),$("#errorInfoyzm").html('<i class="iconfont">&#xe63d;</i>'+o.errorMessage))})}}),$("#verify").blur(function(){var o=$.trim($(this).attr("placeholder"));e($.trim($(this).val()))||$(this).val()==o||$("#errorInfoyzm").html("")})}),window.top!==window.self&&(window.top.location=window.location),$(function(){window.localStorage.getItem("username")&&0!=window.localStorage.getItem("username")&&($("#username").val(window.localStorage.getItem("username")),window.localStorage.setItem("username",""),$("#password").val("")),$(".usename").click(function(){$("#username").val("")}),$(".password1").click(function(){$("#password").val("")}),$("body").bind("keyup",function(e){e&&13==e.keyCode&&checkCookie()})});